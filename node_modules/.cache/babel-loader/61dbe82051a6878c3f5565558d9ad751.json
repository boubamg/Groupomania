{"ast":null,"code":"import _defineProperty from\"/Users/maiga/Desktop/DWJ OPC/P7_Maiga_Boubacar/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/Users/maiga/Desktop/DWJ OPC/P7_Maiga_Boubacar/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/maiga/Desktop/DWJ OPC/P7_Maiga_Boubacar/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/maiga/Desktop/DWJ OPC/P7_Maiga_Boubacar/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/maiga/Desktop/DWJ OPC/P7_Maiga_Boubacar/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import SignIn from'../../Form/Login_form';import userAPI from'../../../Api/userAPI';import{Redirect}from'react-router-dom';import'./Connexion.css';var loginForm=/*#__PURE__*/function(_Component){_inherits(loginForm,_Component);var _super=_createSuper(loginForm);function loginForm(){var _this;_classCallCheck(this,loginForm);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={email:\"\",password:\"\",admin:false,formIsValid:true,errors:{},redirection:false};_this.handleChange=function(event){var _event$target=event.target,name=_event$target.name,value=_event$target.value;_this.setState(_defineProperty({},name,value));};_this.verification=function(){var _this$state=_this.state,email=_this$state.email,password=_this$state.password,errors=_this$state.errors,formIsValid=_this$state.formIsValid;if(!/^[A-Za-z0-9_.-]+@[A-Za-z0-9_.-]+\\.[A-Za-z]{2,}$/.test(email)){errors['email']=\"L'email est invalide\";_this.setState({formIsValid:false});}if(!password||password.length<8){errors[\"password\"]=\"Le mot de passe est invalide\";_this.setState({formIsValid:false});}_this.setState({errors:errors});return formIsValid;};_this.handleSubmit=function(event){event.preventDefault();var _this$state2=_this.state,email=_this$state2.email,password=_this$state2.password;if(_this.verification()){userAPI.login(email,password).then(function(response){if(response.data.isAdmin){_this.setState({admin:true});}localStorage.setItem('token',response.data.token);localStorage.setItem('userId',response.data.userId);// redirect\n_this.setState({redirection:true});}).catch(function(err){return console.log(err);});}else{console.log(\"Form has errors\");}_this.setState({formIsValid:true});};return _this;}_createClass(loginForm,[{key:\"render\",value:function render(){if(localStorage.getItem('token')){return/*#__PURE__*/React.createElement(Redirect,{to:\"/post\"});}if(this.state.redirection){return/*#__PURE__*/React.createElement(Redirect,{to:\"/post\"});}var _this$state3=this.state,email=_this$state3.email,password=_this$state3.password,errors=_this$state3.errors;var errorArray=Object.keys(errors).map(function(id){return/*#__PURE__*/React.createElement(\"p\",{className:\"errors\",key:id},errors[id]);});return/*#__PURE__*/React.createElement(SignIn,{emailValue:email,passwordValue:password,Change:this.handleChange,Submit:this.handleSubmit,errors:errorArray});}}]);return loginForm;}(Component);export default loginForm;","map":{"version":3,"sources":["/Users/maiga/Desktop/DWJ OPC/P7_Maiga_Boubacar/frontend/src/components/User/Connexion/Login.js"],"names":["React","Component","SignIn","userAPI","Redirect","loginForm","state","email","password","admin","formIsValid","errors","redirection","handleChange","event","target","name","value","setState","verification","test","length","handleSubmit","preventDefault","login","then","response","data","isAdmin","localStorage","setItem","token","userId","catch","err","console","log","getItem","errorArray","Object","keys","map","id"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\n\nimport SignIn from '../../Form/Login_form'\nimport userAPI from '../../../Api/userAPI'\nimport {Redirect} from 'react-router-dom'\nimport './Connexion.css'\n\nclass loginForm extends Component {\n\n    state = {\n        email: \"\",\n        password: \"\",\n        admin: false,\n        formIsValid: true,\n        errors : {},\n        redirection: false\n    }\n\n    handleChange = event => {\n        const {name,value} = event.target;\n        this.setState({[name]: value})\n    }\n\n    verification = () => {\n        const {email, password, errors, formIsValid} = this.state;\n        if(!/^[A-Za-z0-9_.-]+@[A-Za-z0-9_.-]+\\.[A-Za-z]{2,}$/.test(email)){\n        errors['email'] = \"L'email est invalide\";\n        this.setState({formIsValid: false})\n        }\n\n        if(!password || password.length < 8 ){\n            errors[\"password\"] = \"Le mot de passe est invalide\";\n            this.setState({formIsValid: false})\n        }\n        this.setState({errors})\n        return formIsValid;\n    }\n\n    handleSubmit = (event) => {\n        event.preventDefault()\n        const {email, password} = this.state\n\n        if(this.verification()){\n            userAPI.login(email, password)\n            .then(response => { \n                if(response.data.isAdmin){\n                    this.setState({admin: true})\n                }\n                localStorage.setItem('token', response.data.token)\n                localStorage.setItem('userId', response.data.userId)\n                \n                // redirect\n                this.setState({redirection: true})\n            })\n            .catch(err => console.log(err))\n        } else {\n            console.log(\"Form has errors\")\n        }\n\n        this.setState({formIsValid: true})\n    }\n\n    render () {\n\n        if(localStorage.getItem('token')){\n            return <Redirect to='/post' />\n        }\n        \n        if(this.state.redirection){\n            return <Redirect to='/post'/>;\n\n        }\n\n        let {email, password, errors} = this.state\n\n        let errorArray = Object.keys(errors)\n        .map(id => (\n            <p className=\"errors\" key={id}>\n                {errors[id]}\n            </p>\n        ))\n\n        return (\n\n            <SignIn\n            emailValue={email}\n            passwordValue={password}\n            Change={this.handleChange} \n            Submit={this.handleSubmit}\n            errors={errorArray}\n            />\n        )\n    }\n}\n\nexport default loginForm"]},"metadata":{},"sourceType":"module"}